# 网站部署自动化脚本

## 概述

这是一个Linux环境下的网站部署自动化脚本，旨在简化网站更新流程，提供一键式备份、清理和部署新站点的功能。

## 功能特点

- **自动备份**：将当前站点完整备份到带有时间戳的目录
- **安全清理**：清理目标站点目录，支持用户确认
- **快速部署**：将新站点内容复制到目标位置
- **详细日志**：记录整个部署过程，便于问题排查
- **灵活配置**：支持命令行参数自定义路径
- **错误处理**：完善的错误检查和提示

## 使用方法

### 基本用法

```bash
sudo ./deploy_site.sh
```

### 命令行选项

```
-h, --help           显示帮助信息
-b, --backup-root    指定备份根目录（默认为当前目录）
-t, --target-dir     指定目标站点目录
-s, --source-dir     指定新站点源目录
-y, --yes            自动确认所有操作（不提示用户确认）
```

### 示例

1. 基本使用（使用默认配置）：
   ```bash
   sudo ./deploy_site.sh
   ```

2. 自定义备份目录：
   ```bash
   sudo ./deploy_site.sh -b /var/backups
   ```

3. 完全自定义路径：
   ```bash
   sudo ./deploy_site.sh -b /backup -t /var/www/site -s /home/user/new_site
   ```

4. 自动执行（不提示确认）：
   ```bash
   sudo ./deploy_site.sh -y
   ```

## 默认配置

- **备份根目录**：当前目录
- **目标站点目录**：`/usr/local/app/websites/dataops/`
- **新站点源目录**：`/home/3223901/src/Data Asset Management.NorthAsia.HUA/WebApp/DataOps.Web/`
- **备份目录格式**：`DataOps.Web_YYYYMMDDHHMMSS`
- **日志文件格式**：`deployment_YYYYMMDDHHMMSS.log`

## 执行流程

1. **显示配置信息**：展示当前的备份、源和目标目录
2. **用户确认**：询问是否继续执行（除非使用`-y`选项）
3. **配置验证**：检查目录是否存在和权限
4. **创建备份**：将当前站点复制到备份目录
5. **清理目标**：删除目标目录下的所有文件
6. **部署新站点**：将新站点文件复制到目标目录
7. **完成报告**：显示部署结果和备份位置

## 注意事项

1. **权限要求**：脚本需要对目标目录有读写权限，建议使用`sudo`运行
2. **数据安全**：
   - 确保备份完成后再进行删除操作
   - 重要数据建议额外备份
3. **测试建议**：首次使用建议在非生产环境测试
4. **日志查看**：部署日志保存在当前目录，可用于问题排查

## 错误处理

脚本包含以下错误检查：

- 目录是否存在
- 目录权限是否足够
- 备份操作是否成功
- 删除操作是否成功
- 复制操作是否成功

## 扩展建议

1. **添加版本控制**：集成Git等版本控制系统
2. **远程部署**：支持SSH远程服务器部署
3. **数据库处理**：添加数据库备份和迁移功能
4. **配置文件保留**：保留特定的配置文件不被覆盖
5. **邮件通知**：部署完成后发送邮件通知
6. **回滚功能**：支持从备份恢复到之前的版本

## 联系方式

如有问题或建议，请联系脚本作者。
